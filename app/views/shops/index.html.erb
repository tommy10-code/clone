<div class="flex h-screen">
  <!-- 左側：地図 -->
  <div class="w-2/3 flex flex-col">
    <div id="map" class="h-2/3 w-full"></div>
  

  <!-- 左側：検索窓 -->
    <%= search_form_for @q, url: shops_path, method: :get do |f| %>
      <div class="flex items-center space-x-2 mb-4">
        <div>
          <%= f.label :category_id_eq, "カテゴリ検索" %>
          <%= f.collection_select :category_id_eq, Category.all, :id, :name, { include_blank: "すべて" }, class: "border px-4 py-2 rounded w-full bg-white" %>
        </div>

    <!-- キーワード検索（幅を広げる） -->
      <div class="flex flex-col flex-grow">
        <%= f.label :title_or_address_cont, "キーワード検索" %>
        <div class="flex space-x-2 w-full">
          <%= f.search_field :title_or_address_cont, placeholder: "タイトルまたは住所", class: "border px-4 py-2 rounded bg-white w-full" %>
          <%= f.submit "検索", class: "bg-blue-500 text-white px-4 py-2 rounded whitespace-nowrap" %>
        </div>
      </div>


      </div>
    <% end %>
    
  </div>

  <!-- 右側：お店一覧（地図と高さ合わせる） -->
  <div class="w-1/3 p-4 overflow-y-auto bg-white h-2/3">
    <h2 class="text-xl font-bold mb-4">お店一覧</h2>
    <% @shops.each do |shop| %>
      <div class="mb-4 border-b pb-2">
        <h3 class="text-lg font-semibold">
          <%= shop.title %>
        </h3>
          <p class="text-sm text-gray-600">
          <%= link_to "お店詳細", shop_path(shop), class: "inline-block mt-2 text-sm text-white bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded" %>

            カテゴリ: <%= shop.category&.name || "" %></p>
      </div>
    <% end %>
  </div>
</div>

<div id="map" style="height: 500px; width: 100%;"></div>

<!-- Google Maps API読み込み：callback=initMap に任せる -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap">
</script>

<!-- 地図初期化関数（Google APIのcallbackとして定義）-->
<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 13,
      center: { lat: 35.170915, lng: 136.881537 } // 名古屋駅周辺
    });

    <% @shops.each do |shop| %>
      <% if shop.latitude.present? && shop.longitude.present? %>
        new google.maps.Marker({
          position: { lat: <%= shop.latitude %>, lng: <%= shop.longitude %> },
          map: map,
          title: "<%= j shop.title %>"
        });
      <% end %>
    <% end %>
  }

  // Google Maps API の callback に使うためグローバル定義
  window.initMap = initMap;
</script>
