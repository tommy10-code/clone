<%= turbo_frame_tag "right_panel" do %>
  <div class="max-w-3xl mx-auto text-center mt-5 bg-white rounded-xl shadow-lg p-8">
    <div class="flex justify-between items-center mb-6">
      <div class="flex space-x-4 items-center mx-auto">
        <h1 class="text-3xl font-bold">ãŠåº—è©³ç´°</h1>
        <!-- Googleæ¤œç´¢ãƒœã‚¿ãƒ³ -->
        <% if user_signed_in? && (@shop.user == current_user) %>
          <%= link_to edit_shop_path(@shop), class: "text-2xl" do %>
            âœï¸
          <% end %>
          <%= link_to shop_path(@shop), method: :delete, data: { turbo_method: :delete, turbo_confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹?" }, class: "text-2xl" do %>
            ğŸ—‘ï¸
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- åº—å -->
    <div class="mb-4">
      <p class="font-bold">åº—å <span class="text-red-500">*</span></p>
      <p class="text-lg">
      <%= link_to @shop.title, "https://www.google.com/search?q=#{CGI.escape(@shop.title)}",
                  target: "_blank",
                  rel: "noopener",
                  class: "text-blue-600 hover:underline" %>
      </p>
      <div class="mt-2 mb-4">
      <%= link_to "Googleã§ã“ã®ãŠåº—ã‚’æ¤œç´¢",
                  "https://www.google.com/search?q=#{CGI.escape(@shop.title)}",
                  target: "_blank",
                  rel: "noopener",
                  class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" %>
      </div>
    </div>

    <!-- ä½æ‰€ -->
    <div class="mb-4">
      <p class="font-bold">ä½æ‰€ <span class="text-red-500">*</span></p>
      <p class="text-lg"> <%= @shop.address %> </p>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒª -->
    <div class="mb-4">
      <p class="font-bold">ã‚«ãƒ†ã‚´ãƒª <span class="text-red-500">*</span></p>
      <p class="text-lg"> <%= @shop.category&.name || "" %> </p>
    </div>

    <!-- ãƒ‡ãƒ¼ãƒˆã‚·ãƒ¼ãƒ³ -->
    <div class="mb-4">
      <p class="font-bold">ãƒ‡ãƒ¼ãƒˆã‚·ãƒ¼ãƒ³ <span class="text-red-500">*</span></p>
        <% if @shop.scenes.any? %>
          <%= @shop.scenes.order(:name).map(&:name).join(" / ") %>
        <% else %>
          æœªè¨­å®š
        <% end %>
    </div>

    <!-- ãŠåº—ã®ç”»åƒ -->
    <div class="mb-6">
      <p class="font-bold mb-2">ãŠåº—ã®ç”»åƒ</p>
        <% if @shop.images.attached? %>
        <div class="flex flex-wrap gap-4">
          <% @shop.images.each do |img| %>
          <%= image_tag img.variant(resize_to_fill: [200, 200]).processed, class: "w-[200px] h-[200px] object-cover rounded" %>
          <% end %>
        </div>
          <% else %>
          <p class="text-gray-500">ç”»åƒã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
        <% end %>
    </div>

    <div class="text-center">
      <% frame_target = turbo_frame_request? ? "right_panel" : "_top" %>
      <%= link_to "ä¸€è¦§ã¸æˆ»ã‚‹", shops_path , data: { turbo_frame: frame_target }, class: "bg-orange-400 hover:bg-orange-500 text-white px-6 py-2 rounded" %>
    </div>
  </div>

<% end %>

<!--
<div id="map" class="h-64 md:h-80 rounded mt-8 max-w-3xl mx-auto p-6 mb-5"></div>

<script>
  // åå¤å±‹é§…ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¸­å¿ƒ
  const NAGOYA = { lat: 35.170915, lng: 136.881537 };

  function initMap() {
    const el = document.getElementById("map");
    if (!el) return;

    const map = new google.maps.Map(el, {
      zoom: 15,
      center: NAGOYA,
      mapTypeControl: false,
      streetViewControl: false
    });

    // ã‚µãƒ¼ãƒã‹ã‚‰åŸ‹ã‚è¾¼ã¿ï¼ˆnil â†’ nullï¼‰
    const lat = <%= @shop.latitude || 'null' %>;
    const lng = <%= @shop.longitude || 'null' %>;
    const title = "<%= j @shop.title.to_s %>";
    const address = "<%= j @shop.address.to_s %>";

    // ç·¯åº¦çµŒåº¦ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
    if (lat && lng) {
      const pos = { lat: lat, lng: lng };
      map.setCenter(pos);
      new google.maps.Marker({ position: pos, map: map, title: title });
      return;
    }

    // ãªã‘ã‚Œã°ä½æ‰€ã‹ã‚‰1å›ã ã‘ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
    if (address.length > 0) {
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address: address }, (results, status) => {
        if (status === "OK" && results[0]) {
          const loc = results[0].geometry.location;
          map.setCenter(loc);
          new google.maps.Marker({ position: loc, map: map, title: title });
        } else {
          console.warn("Geocode failed:", status);
        }
      });
    }
  }

  // Turboã‚’ä½¿ã£ã¦ã‚‹ãªã‚‰ã“ã‚Œã‚‚
  document.addEventListener("turbo:load", initMap);
  // Google Maps callback ç”¨
  window.initMap = initMap;
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap"></script>
-->