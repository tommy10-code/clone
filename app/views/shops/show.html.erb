<%= turbo_frame_tag "right_panel" do %>
  <div class="max-w-3xl mx-auto text-center mt-5 bg-white rounded-xl shadow-lg p-8">
    <div class="flex justify-between items-center mb-6">
      <div class="flex space-x-4 items-center mx-auto">
        <h1 class="text-3xl font-bold">お店詳細</h1>
        <!-- Google検索ボタン -->
        <% if user_signed_in? && (@shop.user == current_user) %>
          <%= link_to edit_shop_path(@shop), class: "text-2xl" do %>
            ✏️
          <% end %>
          <%= link_to shop_path(@shop), method: :delete, data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか?" }, class: "text-2xl" do %>
            🗑️
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- 店名 -->
    <div class="mb-4">
      <p class="font-bold">店名 <span class="text-red-500">*</span></p>
      <p class="text-lg">
      <%= link_to @shop.title, "https://www.google.com/search?q=#{CGI.escape(@shop.title)}",
                  target: "_blank",
                  rel: "noopener",
                  class: "text-blue-600 hover:underline" %>
      </p>
      <div class="mt-2 mb-4">
      <%= link_to "Googleでこのお店を検索",
                  "https://www.google.com/search?q=#{CGI.escape(@shop.title)}",
                  target: "_blank",
                  rel: "noopener",
                  class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" %>
      </div>
    </div>

    <!-- 住所 -->
    <div class="mb-4">
      <p class="font-bold">住所 <span class="text-red-500">*</span></p>
      <p class="text-lg"> <%= @shop.address %> </p>
    </div>

    <!-- カテゴリ -->
    <div class="mb-4">
      <p class="font-bold">カテゴリ <span class="text-red-500">*</span></p>
      <p class="text-lg"> <%= @shop.category&.name || "" %> </p>
    </div>

    <!-- デートシーン -->
    <div class="mb-4">
      <p class="font-bold">デートシーン <span class="text-red-500">*</span></p>
        <% if @shop.scenes.any? %>
          <%= @shop.scenes.order(:name).map(&:name).join(" / ") %>
        <% else %>
          未設定
        <% end %>
    </div>

    <!-- お店の画像 -->
    <div class="mb-6">
      <p class="font-bold mb-2">お店の画像</p>
        <% if @shop.images.attached? %>
        <div class="flex flex-wrap gap-4">
          <% @shop.images.each do |img| %>
          <%= image_tag img.variant(resize_to_fill: [200, 200]).processed, class: "w-[200px] h-[200px] object-cover rounded" %>
          <% end %>
        </div>
          <% else %>
          <p class="text-gray-500">画像はまだ登録されていません</p>
        <% end %>
    </div>

    <div class="text-center">
      <% frame_target = turbo_frame_request? ? "right_panel" : "_top" %>
      <%= link_to "一覧へ戻る", shops_path , data: { turbo_frame: frame_target }, class: "bg-orange-400 hover:bg-orange-500 text-white px-6 py-2 rounded" %>
    </div>
  </div>

<% end %>

<!--
<div id="map" class="h-64 md:h-80 rounded mt-8 max-w-3xl mx-auto p-6 mb-5"></div>

<script>
  // 名古屋駅をデフォルト中心
  const NAGOYA = { lat: 35.170915, lng: 136.881537 };

  function initMap() {
    const el = document.getElementById("map");
    if (!el) return;

    const map = new google.maps.Map(el, {
      zoom: 15,
      center: NAGOYA,
      mapTypeControl: false,
      streetViewControl: false
    });

    // サーバから埋め込み（nil → null）
    const lat = <%= @shop.latitude || 'null' %>;
    const lng = <%= @shop.longitude || 'null' %>;
    const title = "<%= j @shop.title.to_s %>";
    const address = "<%= j @shop.address.to_s %>";

    // 緯度経度があればそれを使う
    if (lat && lng) {
      const pos = { lat: lat, lng: lng };
      map.setCenter(pos);
      new google.maps.Marker({ position: pos, map: map, title: title });
      return;
    }

    // なければ住所から1回だけジオコーディング
    if (address.length > 0) {
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address: address }, (results, status) => {
        if (status === "OK" && results[0]) {
          const loc = results[0].geometry.location;
          map.setCenter(loc);
          new google.maps.Marker({ position: loc, map: map, title: title });
        } else {
          console.warn("Geocode failed:", status);
        }
      });
    }
  }

  // Turboを使ってるならこれも
  document.addEventListener("turbo:load", initMap);
  // Google Maps callback 用
  window.initMap = initMap;
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap"></script>
-->